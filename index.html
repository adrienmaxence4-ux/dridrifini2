<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Espace Cr√©atif - V√©rif pseudo (plus stricte)</title>
  <style>
    body{
      font-family: "Poppins",sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
      margin:0;
      background: linear-gradient(135deg,#ffe29f,#ffa99f);
      color:#222;
      padding:20px;
      box-sizing:border-box;
    }
    .card{
      background:rgba(255,255,255,0.96);
      padding:22px;
      border-radius:12px;
      width:100%;
      max-width:520px;
      box-shadow:0 8px 30px rgba(0,0,0,0.12);
      text-align:center;
    }
    h1{margin:0 0 14px;font-size:1.6rem}
    .btn{background:#fff;border:none;border-radius:10px;padding:12px 18px;margin:8px;font-size:1rem;cursor:pointer;transition:all .18s;}
    .btn:hover{transform:scale(1.03)}
    input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #cfcfcf;margin-top:8px;font-size:0.98rem;box-sizing:border-box;}
    #formulaire{display:none;margin-top:12px;text-align:left}
    #result{margin-top:14px;font-weight:600;white-space:pre-line}
    .spinner{display:inline-block;width:18px;height:18px;border:3px solid rgba(0,0,0,0.15);border-top-color:#333;border-radius:50%;animation:spin .9s linear infinite;vertical-align:middle;margin-right:8px;}
    @keyframes spin{to{transform:rotate(360deg)}}
    .small{font-size:0.9rem;color:#555}
    .note{font-size:0.85rem;color:#666;margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h1>üé® Espace Cr√©atif ‚Äî Soumission artiste</h1>

    <div id="choice">
      <button class="btn" onclick="choose('artiste')">Je suis Artiste</button>
      <button class="btn" onclick="choose('visiteur')">Je suis Visiteur</button>
    </div>

    <div id="formulaire">
      <label class="small">üñåÔ∏è Pseudo Discord (ex: MonPseudo#1234) :</label>
      <input id="nom" type="text" placeholder="Ex : @MonPseudo#1234 ou MonPseudo#1234" />

      <label class="small" style="margin-top:10px">üé≠ Domaine artistique :</label>
      <select id="domaine">
        <option value="">-- Choisissez votre domaine --</option>
        <option>üé® Dessin / Illustration</option>
        <option>üñåÔ∏è Peinture</option>
        <option>üì∑ Photographie</option>
        <option>üé¨ Vid√©o / Montage</option>
        <option>üéµ Musique</option>
        <option>üé§ Chant</option>
        <option>üíª Arts num√©riques</option>
        <option>üßµ Couture / Mode</option>
        <option>üß± Sculpture / 3D</option>
        <option>üìö √âcriture</option>
      </select>

      <label class="small" style="margin-top:10px">üñºÔ∏è Lien vers votre travail :</label>
      <input id="lien" type="url" placeholder="https://instagram.com/monpseudo" />

      <div style="display:flex;gap:8px;margin-top:12px">
        <button class="btn" onclick="submitArtist()" style="flex:1">Envoyer pour v√©rif</button>
        <button class="btn" onclick="resetForm()" style="flex:0">Annuler</button>
      </div>

      <div class="note">
        Astuce : pour une v√©rif plus rapide, donne ton tag exact (Pseudo#1234) ou ton ID (suite de chiffres).
      </div>
    </div>

    <div id="result"></div>
  </div>

  <script>
    // üîß Remplace par ton webhook Discord (ex: https://discord.com/api/webhooks/xxx/yyy)
    const webhookURL = "https://discord.com/api/webhooks/1430205464226037945/DZG49PMOKi81MASgrJoBioJrznSAvrH5fIqTv6Yupu8y0ZuT8ClQfQzvJM-BGiQkv10A";

    function choose(role){
      document.getElementById('choice').style.display = 'none';
      const form = document.getElementById('formulaire');
      const result = document.getElementById('result');
      result.innerText = '';
      if(role === 'artiste'){
        form.style.display = 'block';
      } else {
        form.style.display = 'none';
        result.innerText = "üëã Bienvenue visiteur ! Ton arriv√©e a √©t√© notifi√©e sur Discord.";
        sendVisitorToDiscord();
      }
    }

    function resetForm(){
      document.getElementById('choice').style.display = 'block';
      document.getElementById('formulaire').style.display = 'none';
      document.getElementById('result').innerText = '';
      document.getElementById('nom').value = '';
      document.getElementById('domaine').selectedIndex = 0;
      document.getElementById('lien').value = '';
    }

    // NOUVEAU : v√©rif d√©terministe c√¥t√© client
    // Accepte comme "probable" uniquement :
    // - Discord tag : Pseudo#1234  (optionnellement pr√©c√©d√© d'un @)
    // - ou un ID Discord : suite de 17-20 chiffres
    function checkDiscordPseudoFormat(pseudo){
      if(!pseudo) return {valid:false, reason:'Vide'};
      // nettoie espaces
      const s = pseudo.trim();
      // regex tag (avec ou sans @) : /^@?(.{1,32})#(\d{4})$/
      const tagRegex = /^@?(.{1,32})#(\d{4})$/;
      const idRegex = /^(\d{17,20})$/;
      if(tagRegex.test(s)) return {valid:true, type:'tag', reason:'Tag valide (Pseudo#1234)'};
      if(idRegex.test(s)) return {valid:true, type:'id', reason:'ID Discord valide (suite de chiffres)'};
      // si commence par @ et sans # ‚Äî on consid√®re invalide pour √™tre strict
      return {valid:false, reason:'Format invalide. Donne un Tag (Pseudo#1234) ou un ID (suite de chiffres).'};
    }

    function submitArtist(){
      const nomRaw = document.getElementById('nom').value.trim();
      const domaine = document.getElementById('domaine').value.trim();
      const lien = document.getElementById('lien').value.trim();
      const resultEl = document.getElementById('result');

      if(!nomRaw || !domaine || !lien){
        resultEl.innerText = "‚ùó Merci de remplir tous les champs (pseudo, domaine, lien).";
        return;
      }

      // affichage du chargement
      resultEl.innerHTML = '<span class="spinner"></span>V√©rification du pseudo en cours...';

      // petit d√©lai pour l'effet de v√©rif
      setTimeout(() => {
        const check = checkDiscordPseudoFormat(nomRaw);
        if(check.valid){
          resultEl.innerHTML =
            "‚úÖ Format du pseudo : OK (" + check.reason + ").\n" +
            "‚úÖ Ton lien a √©t√© envoy√© aux mod√©rateurs pour validation.\n" +
            "(Le staff confirmera sur Discord si le compte existe sur le serveur.)";
        } else {
          resultEl.innerHTML =
            "‚ö†Ô∏è Format du pseudo : NON VALIDE.\n" +
            check.reason + "\n\n" +
            "Ton lien a quand m√™me √©t√© envoy√© aux mod√©rateurs pour v√©rification manuelle. " +
            "Donne un tag exact (Pseudo#1234) ou ton ID pour acc√©l√©rer la validation.";
        }

        // Pr√©pare le message envoy√© au webhook (inclut le r√©sultat du contr√¥le de format)
        const payload = {
          content:
            `üé® **Nouvelle soumission artiste**\n` +
            `üë§ Pseudo d√©clar√© : ${nomRaw}\n` +
            `üìÇ Domaine : ${domaine}\n` +
            `üîó Lien : ${lien}\n` +
            `üîé Contr√¥le format pseudo : ${check.valid ? 'format valide' : 'format invalide'} (${check.reason})\n` +
            `‚ö†Ô∏è Note : v√©rification r√©elle du compte √† faire manuellement par le staff sur Discord.`
        };

        fetch(webhookURL, {
          method:'POST',
          headers:{ 'Content-Type':'application/json' },
          body: JSON.stringify(payload)
        }).catch(err => {
          console.error('Erreur fetch webhook:', err);
          resultEl.innerHTML += "\n\n‚ùó Erreur lors de l'envoi de la notification (v√©rifie ton webhook).";
        });

      }, 900);
    }

    function sendVisitorToDiscord(){
      const payload = { content: "üëÄ Un nouveau visiteur vient de d√©couvrir le site !" };
      fetch(webhookURL, {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      }).catch(err => console.error('Erreur fetch webhook:', err));
    }
  </script>
</body>
</html>
